<!-- index.html -->
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Task Example</title>
<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
</head>
<body>

    <button type="button">Run Task</button>
    <br>
    Result: <span id="result"></span>

<script>
    const resultElement = document.getElementById('result'),
          client = io("[[ = t_vars['sio_serv_url'] ]]");

    let clientid = null;

    client.on('register', function(id) {
        clientid = id;
    });

    client.on('longtask_notify', function(result) {
        resultElement.textContent = result;
    });

    document.querySelector('button').onclick = function() {

// let json = JSON.stringify({
//  clientid: clientid,
// });

        const request = new XMLHttpRequest();
        request.open('POST', "[[ = t_vars['longtask_run_url'] ]]" , true);
 //       request.setRequestHeader('Content-type', 'application/json; charset=utf-8');

        request.setRequestHeader(
            'Content-Type',
            'application/x-www-form-urlencoded; charset=utf-8');
        request.onload = function() {
            resultElement.textContent = request.responseText;
        };
  //      request.send(json);
        request.send('clientid=' + clientid);
    };
</script>


</body>
</html>


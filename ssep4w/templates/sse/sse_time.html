[[extend 'layout.html']]

<button type="button" onclick="window.open(  window.location.href  );">new tab</button>
<button id="breaj_but" type="button" onclick="window.location.reload(true);">reload</button>

<p>./py4web.py run apps --watch=off -s wsgirefThreadingServer</p>
<p id='gen_id'></p>
<p id="time"></p>
<p id="value"></p>


<script>
   const source = new EventSource("[[=stream_url ]]");
   source.onmessage = function (e) {
       const fs= '1.4em';
       const data = JSON.parse(e.data);

       document.getElementById("time").innerHTML = data.time;
       document.getElementById("time").style.fontSize = fs;

       document.getElementById("value").innerHTML = data.value;
       document.getElementById("value").style.fontSize = fs;
   }

   source.addEventListener("generator_start", function(e) {
       const data = JSON.parse(e.data);
       document.getElementById("gen_id").innerHTML = 'Generator id: ' + data.gen_id;
   });

   source.onerror = function(e) {
           console.error("EventSource failed:", e);
           if (e.readyState == EventSource.CLOSED) {
            console.log('sse bye! connectioni closed!');
            }
   };

   source.addEventListener("open", (event) => {
         // Prints the information about an event
         console.log('open connection! ',event);
   });




</script>

